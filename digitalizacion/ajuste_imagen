import cv2
import os
import matplotlib.pyplot as plt

# Ruta base del script
BASE_DIR = os.path.dirname(os.path.abspath(__file__))

# Rutas
input_path = os.path.join(BASE_DIR, "data", "documento_medico.jpeg")
output_path = os.path.join(BASE_DIR, "data", "resultado_visual_bnw.jpeg")

# Cargar imagen
image = cv2.imread(input_path)

if image is None:
    raise FileNotFoundError(f"No se pudo cargar la imagen en {input_path}")

# Preprocesamiento
gray = cv2.cvtColor(image, cv2.COLOR_BGR2GRAY)
blur = cv2.GaussianBlur(gray, (5, 5), 0)

thresh = cv2.adaptiveThreshold(
    blur,
    255,
    cv2.ADAPTIVE_THRESH_GAUSSIAN_C,
    cv2.THRESH_BINARY,
    11,
    2
)

# ðŸ”¹ Guardar imagen preprocesada
cv2.imwrite(output_path, thresh)

print(f"Imagen preprocesada guardada en: {output_path}")

# Mostrar resultados
plt.figure(figsize=(10,5))

plt.subplot(1,2,1)
plt.title("Original")
plt.imshow(cv2.cvtColor(image, cv2.COLOR_BGR2RGB))
plt.axis("off")

plt.subplot(1,2,2)
plt.title("Preprocesada")
plt.imshow(thresh, cmap="gray")
plt.axis("off")

plt.show()
